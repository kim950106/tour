<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>MBTI ê´€ê³„ë„</title>

    <style>
      :root {
        --brand:#2563eb;
        --brand-dark:#1d4ed8;
        --bg:#0f172a;
        --panel:#ffffff;
        --line:#e5e7eb;
        --good:#16a34a;
        --normal:#f59e0b;
        --effort:#ef4444;
      }

      *{
        box-sizing:border-box;
        margin:0;padding:0;
        -webkit-tap-highlight-color:transparent;
      }
      body{
        font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
        background:var(--bg);
        color:#0f172a;
        min-height:100vh;
        padding:8px;
      }

      .app{
        max-width:480px;
        margin:0 auto;
        background:var(--panel);
        border-radius:16px;
        overflow:hidden;
        display:flex;
        flex-direction:column;
        min-height:calc(100vh - 16px);
        box-shadow:0 14px 40px rgba(0,0,0,.35);
      }

      /* ğŸ”¥ ëŒì•„ê°€ê¸° ì•„ì´ì½˜ (Floating Button) */
      .btn-floating-back{
        position:fixed;
        top:14px;
        left:14px;
        width:42px;
        height:42px;
        border-radius:50%;
        background:rgba(15,23,42,0.85);
        backdrop-filter:blur(4px);
        color:#fff;
        font-size:22px;
        display:flex;
        align-items:center;
        justify-content:center;
        cursor:pointer;
        z-index:9999;
        border:1px solid rgba(255,255,255,.15);
        box-shadow:0 5px 14px rgba(0,0,0,.35);
      }
      .btn-floating-back:active{
        background:rgba(15,23,42,1);
      }

      .top{
        position:sticky;
        top:0;
        z-index:10;
        background:linear-gradient(135deg,#1d4ed8,#38bdf8);
        color:#fff;
        padding:12px 10px 10px;
      }
      .top-title{
        font-weight:800;
        font-size:16px;
        text-align:center;
        margin-bottom:8px;
      }

      .top-row{
        display:flex;
        gap:6px;
        margin-bottom:6px;
      }
      .top-row input,
      .top-row select{
        flex:1;
        border-radius:10px;
        border:0;
        padding:8px 9px;
        font-size:13px;
      }
      .top-row input::placeholder{
        color:#9ca3af;
      }

      .btn-main{
        width:100%;
        border:0;
        border-radius:10px;
        background:#f97316;
        color:#fff;
        font-weight:700;
        padding:9px 0;
        font-size:14px;
        cursor:pointer;
      }
      .btn-main:active{
        background:#ea580c;
      }

      .top-target{
        margin-top:6px;
        font-size:12px;
        text-align:center;
        opacity:.9;
      }

      .content{
        flex:1;
        overflow:auto;
        padding:10px;
        display:flex;
        flex-direction:column;
        gap:10px;
      }

      .section{
        border-radius:12px;
        padding:8px 9px;
      }
      .sec-title{
        font-weight:800;
        margin-bottom:4px;
        font-size:13px;
      }
      .sec-sub{
        font-size:11px;
        opacity:.7;
        margin-bottom:6px;
      }

      .sec-good{background:#ecfdf3;border:1px solid #bbf7d0;}
      .sec-normal{background:#fff7ed;border:1px solid #fed7aa;}
      .sec-effort{background:#fef2f2;border:1px solid #fecaca;}

      .mbti-row{
        display:flex;
        align-items:flex-start;
        gap:6px;
        margin-bottom:4px;
        flex-wrap:wrap;
      }
      .mbti-label{
        min-width:48px;
        padding:6px 6px;
        border-radius:999px;
        background:#eff6ff;
        text-align:center;
        font-size:11px;
        font-weight:800;
        color:#1d4ed8;
      }
      .chip-wrap{
        display:flex;
        flex-wrap:wrap;
        gap:4px;
      }
      .chip{
        font-size:11px;
        padding:5px 8px;
        border-radius:999px;
        border:1px solid var(--line);
        background:#fff;
        cursor:pointer;
      }
      .chip span.count{
        font-size:10px;
        opacity:.7;
        margin-left:4px;
      }

      .empty{
        font-size:12px;
        text-align:center;
        padding:12px 4px;
        color:#9ca3af;
      }

      .bottom{
        position:sticky;
        bottom:0;
        background:#0f172a;
        color:#e5e7eb;
        padding:8px 10px;
        font-size:11px;
      }
      .bottom-title{
        font-weight:700;
        margin-bottom:4px;
      }
      .bottom-ul{
        list-style:none;
      }
      .bottom-ul li{
        margin-bottom:2px;
      }
    </style>
  </head>

  <body>

    <!-- ğŸ”¥ ëŒì•„ê°€ê¸° ë²„íŠ¼ (ê³ ì • ì•„ì´ì½˜) -->
    <div id="btnBack" class="btn-floating-back">â†</div>

    <div class="app">
      <!-- ìƒë‹¨ ê³ ì • -->
      <header class="top">
        <div class="top-title">ìš°ìˆ˜ì‚¬ë¡€ ì°¸ê°€ì MBTI ê´€ê³„ë„</div>

        <div class="top-row">
          <input id="nameInput" type="text" placeholder="ì´ë¦„ (ì˜ˆ: ê¹€í˜„ì² )" />
          <select id="mbtiInput">
            <option value="">MBTI ì„ íƒ</option>
            <option>INTJ</option><option>INTP</option><option>ENTJ</option><option>ENTP</option>
            <option>INFJ</option><option>INFP</option><option>ENFJ</option><option>ENFP</option>
            <option>ISTJ</option><option>ISFJ</option><option>ESTJ</option><option>ESFJ</option>
            <option>ISTP</option><option>ISFP</option><option>ESTP</option><option>ESFP</option>
          </select>
        </div>

        <button id="btnRun" class="btn-main">ê´€ê³„ë„ ë³´ê¸°</button>

        <div id="targetInfo" class="top-target">
          ì´ë¦„ê³¼ MBTIë¥¼ ì…ë ¥í•˜ê³  ê´€ê³„ë„ë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”.
        </div>
      </header>

      <!-- ì¤‘ê°„ ìŠ¤í¬ë¡¤ -->
      <main class="content" id="content">
        <div class="empty">
          ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.<br />
          ìƒë‹¨ì—ì„œ ì´ë¦„ / MBTIë¥¼ ì…ë ¥í•œ ë’¤ â€˜ê´€ê³„ë„ ë³´ê¸°â€™ë¥¼ ëˆŒëŸ¬ ì£¼ì„¸ìš”.
        </div>
      </main>

      <!-- í•˜ë‹¨ ê³ ì • -->
      <footer class="bottom">
        <div class="bottom-title">ê´€ê³„ë„ ì •ì˜</div>
        <ul class="bottom-ul">
          <li>â€¢ <span style="color:#4ade80;">ì¢‹ìŒ</span> : í˜‘ì—… ì‹œ ì‹œë„ˆì§€ ë†’ìŒ</li>
          <li>â€¢ <span style="color:#fb923c;">ë³´í†µ</span> : ì¡°ìœ¨ì— ë”°ë¼ í˜‘ì—… ê°€ëŠ¥</li>
          <li>â€¢ <span style="color:#fca5a5;">ë…¸ë ¥ í•„ìš”</span> : ì†Œí†µÂ·ë°°ë ¤ í•„ìš”</li>
        </ul>
      </footer>
    </div>

    <script>
      // âœ… Apps Script ì›¹ì•± URL (exec ì£¼ì†Œ ê·¸ëŒ€ë¡œ ë³µë¶™)
      const API_URL = "https://script.google.com/macros/s/AKfycbxgPR8R0tD-eLfWV2tLcaI4SF9sCMh6tJhlYls4Yfzp84EbnoJEhJNShlmTHRqpTb-C/exec";

      // ğŸ”¥ ëŒì•„ê°€ê¸° ì•„ì´ì½˜ â†’ ë§í¬ ì´ë™
      document.getElementById("btnBack").addEventListener("click", () => {
        window.location.href = "https://kim950106.github.io/travel-recommendation/";
      });

      const btnRun = document.getElementById('btnRun');
      const nameInput = document.getElementById('nameInput');
      const mbtiInput = document.getElementById('mbtiInput');
      const targetInfo = document.getElementById('targetInfo');
      const content = document.getElementById('content');

      function renderRelations(data){
        if (data.error){
          targetInfo.textContent = data.error;
          content.innerHTML = '<div class="empty">'+ data.error +'</div>';
          return;
        }

        targetInfo.textContent =
          (data.targetName ? data.targetName + ' / ' : '') +
          'MBTI: ' + data.targetMbti + ' ê¸°ì¤€ ê´€ê³„ë„';

        const groups = data.groups || {good:[], normal:[], effort:[]};

        function renderSection(title, sub, cssClass, items){
          if (!items || items.length === 0){
            return `
              <section class="section ${cssClass}">
                <div class="sec-title">${title}</div>
                <div class="sec-sub">${sub}</div>
                <div class="empty">í•´ë‹¹ë˜ëŠ” MBTIê°€ ì—†ìŠµë‹ˆë‹¤.</div>
              </section>
            `;
          }

          const rows = items.map(item => {
            const names = item.names || [];
            const chipLabel = item.mbti;
            const count = names.length;
            const namesStr = names.join(', ');
            const dataNames = encodeURIComponent(namesStr);

            return `
              <div class="mbti-row">
                <div class="mbti-label">${chipLabel}</div>
                <div class="chip-wrap">
                  <button class="chip"
                          data-names="${dataNames}">
                    ${chipLabel}
                    <span class="count">${count}ëª…</span>
                  </button>
                </div>
              </div>
            `;
          }).join('');

          return `
            <section class="section ${cssClass}">
              <div class="sec-title">${title}</div>
              <div class="sec-sub">${sub}</div>
              ${rows}
            </section>
          `;
        }

        const html = [
          renderSection('ì¢‹ìŒ', 'ì‹œë„ˆì§€ê°€ ë†’ì€ ìœ í˜•', 'sec-good', groups.good),
          renderSection('ë³´í†µ', 'ìƒí™©ì— ë”°ë¼ ë‹¤ë¥¸ ìœ í˜•', 'sec-normal', groups.normal),
          renderSect
