<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <!-- ëª¨ë°”ì¼ ìµœì í™” ë·°í¬íŠ¸ -->
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
  />
  <title>MBTI ê´€ê³„ë„ | LS TourPass</title>
  <style>
    :root{
      --brand-start:#5b7cfa; --brand-end:#7a53c8; --ink:#0f172a; --ink-2:#334155; --muted:#64748b;
      --bg:#ffffff; --panel:#f8fafc; --line:#e2e8f0; --ok:#10b981; --warn:#f59e0b; --bad:#ef4444; --chip:#eef2ff;
    }
    *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}

    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
      background:linear-gradient(135deg,var(--brand-start),var(--brand-end));
      color:var(--ink);
      min-height:100vh;
      padding:8px;
      padding-top:calc(8px + env(safe-area-inset-top, 0px));
      padding-right:calc(8px + env(safe-area-inset-right, 0px));
      padding-bottom:calc(8px + env(safe-area-inset-bottom, 0px));
      padding-left:calc(8px + env(safe-area-inset-left, 0px));
      overflow:auto;
    }

    .app{
      display:flex;
      flex-direction:column;
      min-height:calc(100vh - 16px);
      width:100%;
      max-width:820px;
      margin:0 auto;
      background:var(--bg);
      border-radius:18px;
      box-shadow:0 14px 36px rgba(0,0,0,.16);
      overflow:hidden;
    }

    .header{
      background:linear-gradient(135deg,var(--brand-start),var(--brand-end));
      color:#fff;
      padding:14px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .title{
      font-weight:800;
      font-size:18px;
      letter-spacing:.2px;
      display:flex;
      gap:8px;
      align-items:center;
    }

    .view-toggle{
      display:flex;
      gap:6px;
      background:rgba(15,23,42,.18);
      padding:3px;
      border-radius:999px;
    }
    .view-toggle button{
      border:0;
      background:transparent;
      color:#e5e7eb;
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      cursor:pointer;
      white-space:nowrap;
    }
    .view-toggle button.active{
      background:#fff;
      color:#4f46e5;
      font-weight:800;
      box-shadow:0 4px 10px rgba(15,23,42,.25);
    }

    .controls{
      background:var(--panel);
      border-bottom:1px solid var(--line);
      padding:10px;
    }
    .row{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .row+.row{margin-top:8px}
    .btn{
      appearance:none;
      border:0;
      border-radius:12px;
      padding:9px 11px;
      font-weight:700;
      cursor:pointer;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:4px;
      flex:1;
      min-width:0;
    }

    .btn-primary{
      background:linear-gradient(135deg,#6366f1,#4f46e5);
      color:#fff;
    }
    .btn-outline{
      background:#fff;
      border:2px solid var(--brand-start);
      color:var(--brand-start);
      font-weight:800;
      flex:0 0 auto;
    }

    .input,select{
      flex:1;
      min-width:0;
      background:#fff;
      border:2px solid var(--line);
      border-radius:12px;
      padding:9px 11px;
      font-size:13px;
    }

    .searchrow{
      display:flex;
      gap:8px;
      margin-top:8px;
      flex-wrap:wrap;
    }

    .viz-wrap{
      position:relative;
      flex:1;
      min-height:clamp(260px, 55vh, 480px);
      overflow:hidden;
      background:linear-gradient(135deg,#fff6fb,#eef7ff);
    }
    #stage{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
    }

    .legend{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      padding:8px 12px;
      border-top:1px solid var(--line);
      background:#fff;
    }
    .legend-item{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:12px;
      color:var(--ink-2);
    }
    .legend-dot{
      width:18px;height:4px;border-radius:4px;display:inline-block;
    }

    .stats{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:8px;
      padding:10px 12px;
      background:#fff;
      border-top:1px solid var(--line);
    }
    .stat{
      background:linear-gradient(180deg,#f6f7fb,#eaeef7);
      border-radius:12px;
      padding:10px;
      text-align:center;
    }
    .stat .v{font-weight:900;font-size:14px;}
    .stat .k{font-size:11px;color:var(--muted)}

    /* ë¦¬ìŠ¤íŠ¸ ë·° (í…Œì´ë¸” ëŒ€ì‹  ì¹´ë“œí˜•) */
    .table-view{
      position:absolute;
      inset:0;
      overflow:auto;
      padding:12px;
      display:none;
    }
    .table-view.show{display:block;}

    .table-card{
      background:#fff;
      border:1px solid var(--line);
      border-radius:14px;
      box-shadow:0 8px 18px rgba(0,0,0,.07);
      display:flex;
      flex-direction:column;
      max-height:100%;
    }
    .table-title{
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }
    .table-title span{font-weight:800;font-size:14px;}
    .table-title button{
      border:0;
      background:#f1f5f9;
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      cursor:pointer;
    }

    .rel-list{
      padding:10px 12px 12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      overflow:auto;
    }
    .rel-item{
      border:1px solid var(--line);
      border-radius:12px;
      padding:8px 10px;
      background:#fff;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .rel-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    .rel-name{
      font-weight:800;
      font-size:14px;
    }
    .rel-mbti{
      font-size:11px;
      padding:2px 8px;
      border-radius:999px;
      background:#eef2ff;
      color:#3730a3;
      font-weight:800;
    }
    .rel-summary{
      font-size:12px;
      color:#475569;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .badge{
      font-size:11px;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid #e2e8f0;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    .badge.ok{border-color:var(--ok);color:var(--ok);}
    .badge.warn{border-color:var(--warn);color:var(--warn);}
    .badge.bad{border-color:var(--bad);color:var(--bad);}

    .muted{
      color:#94a3b8;
      font-size:13px;
      padding:16px;
      text-align:center;
    }

    @media (max-width:600px){
      .app{
        border-radius:14px;
        box-shadow:0 10px 24px rgba(0,0,0,.16);
      }
      .header{padding:10px 8px;}
      .title{font-size:16px;}
      .controls{padding:8px;}
      .row{gap:6px;}
      .btn{
        padding:8px 9px;
        font-size:12px;
      }
      .input,select{
        padding:8px 9px;
        font-size:12px;
      }
      .legend{padding:6px 10px;}
      .stats{
        padding:8px 10px;
        gap:6px;
      }
      .viz-wrap{
        min-height:clamp(240px, 50vh, 420px);
      }
      .table-view{padding:8px;}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="title">ğŸŒŸ MBTI ê´€ê³„ë„</div>
      <div class="view-toggle">
        <button id="btnModeGraph" class="active">ê´€ê³„ë„</button>
        <button id="btnModeList">ë¦¬ìŠ¤íŠ¸</button>
      </div>
    </div>

    <div class="controls">
      <div class="row">
        <button id="btn-load" class="btn btn-primary">ğŸ‘¥ ê´€ê³„ë„ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button id="btn-reset" class="btn btn-outline">ì´ˆê¸°í™”</button>
      </div>
      <div class="searchrow">
        <input id="q" class="input" placeholder="ğŸ” ì´ë¦„ ë˜ëŠ” MBTI(ì˜ˆ: ENFP) ê²€ìƒ‰" />
        <select id="filterMbti">
          <option value="">MBTI í•„í„°</option>
          <option>INTJ</option><option>INTP</option><option>ENTJ</option><option>ENTP</option>
          <option>INFJ</option><option>INFP</option><option>ENFJ</option><option>ENFP</option>
          <option>ISTJ</option><option>ISFJ</option><option>ESTJ</option><option>ESFJ</option>
          <option>ISTP</option><option>ISFP</option><option>ESTP</option><option>ESFP</option>
        </select>
      </div>
    </div>

    <div class="viz-wrap">
      <!-- ê¸°ì¡´ ê´€ê³„ë„ ìº”ë²„ìŠ¤/ê·¸ë˜í”„ ì˜ì—­ -->
      <div id="stage"></div>

      <!-- ì´ë¦„/MBTI ê¸°ì¤€ ë¦¬ìŠ¤íŠ¸ ë·° -->
      <div class="table-view" id="listView">
        <div class="table-card">
          <div class="table-title">
            <span>MBTI ê´€ê³„ ë¦¬ìŠ¤íŠ¸</span>
            <button id="btnListClose">ë‹«ê¸°</button>
          </div>
          <div id="relationList" class="rel-list">
            <div class="muted">ìƒë‹¨ì—ì„œ â€œê´€ê³„ë„ ë¶ˆëŸ¬ì˜¤ê¸°â€ë¥¼ ëˆŒëŸ¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ì£¼ì„¸ìš”.</div>
          </div>
        </div>
      </div>
    </div>

    <div class="legend">
      <div class="legend-item">
        <span class="legend-dot" style="background:var(--ok);"></span>
        <span>ì˜ ë§ëŠ” ê´€ê³„</span>
      </div>
      <div class="legend-item">
        <span class="legend-dot" style="background:var(--warn);"></span>
        <span>ì£¼ì˜ í•„ìš”í•œ ê´€ê³„</span>
      </div>
      <div class="legend-item">
        <span class="legend-dot" style="background:var(--bad);"></span>
        <span>ì¶©ëŒ ê°€ëŠ¥ì„± ë†’ì€ ê´€ê³„</span>
      </div>
    </div>

    <div class="stats" id="statsBox">
      <div class="stat">
        <div class="v" id="statTotal">0</div>
        <div class="k">ì „ì²´ ì¸ì›</div>
      </div>
      <div class="stat">
        <div class="v" id="statOk">0</div>
        <div class="k">ì¢‹ì€ ê´€ê³„ ìˆ˜</div>
      </div>
      <div class="stat">
        <div class="v" id="statWarn">0</div>
        <div class="k">ì£¼ì˜/ì¶©ëŒ ê´€ê³„</div>
      </div>
    </div>
  </div>

  <script>
    // â˜… í•„ìš”ì‹œ Apps Script ì›¹ì•± URLë¡œ êµì²´
    // const SHEET_URL = "https://script.google.com/macros/s/xxxx/exec";

    // ì˜ˆì‹œ ë°ì´í„° (êµ¬ê¸€ì‹œíŠ¸ ì—°ë™ ì‹œ ì´ ë¶€ë¶„ì„ fetch ê²°ê³¼ë¡œ ëŒ€ì²´)
    const sampleData = {
      members: [
        { id: 1, name: "ê¹€í˜„ì² ", mbti: "ENFJ" },
        { id: 2, name: "A", mbti: "INTP" },
        { id: 3, name: "B", mbti: "ISTJ" },
        { id: 4, name: "C", mbti: "ENFP" },
      ],
      relations: [
        // level: ok | warn | bad
        { from: 1, to: 2, level: "ok" },
        { from: 1, to: 3, level: "warn" },
        { from: 1, to: 4, level: "ok" },
        { from: 2, to: 3, level: "bad" },
        { from: 3, to: 4, level: "warn" },
      ],
    };

    const state = {
      members: [],
      relations: [],
      mode: "graph", // graph | list
    };

    const elStage = document.getElementById("stage");
    const elListView = document.getElementById("listView");
    const elRelationList = document.getElementById("relationList");
    const elBtnLoad = document.getElementById("btn-load");
    const elBtnReset = document.getElementById("btn-reset");
    const elBtnListClose = document.getElementById("btnListClose");
    const elQ = document.getElementById("q");
    const elFilterMbti = document.getElementById("filterMbti");
    const elStatTotal = document.getElementById("statTotal");
    const elStatOk = document.getElementById("statOk");
    const elStatWarn = document.getElementById("statWarn");
    const elBtnModeGraph = document.getElementById("btnModeGraph");
    const elBtnModeList = document.getElementById("btnModeList");

    function setMode(mode){
      state.mode = mode;
      if(mode === "graph"){
        elStage.style.display = "block";
        elListView.classList.remove("show");
        elBtnModeGraph.classList.add("active");
        elBtnModeList.classList.remove("active");
      }else{
        elStage.style.display = "none";
        elListView.classList.add("show");
        elBtnModeGraph.classList.remove("active");
        elBtnModeList.classList.add("active");
      }
    }

    elBtnModeGraph.addEventListener("click", ()=> setMode("graph"));
    elBtnModeList.addEventListener("click", ()=> setMode("list"));
    elBtnListClose.addEventListener("click", ()=> setMode("graph"));

    // ê´€ê³„ë„ ë¶ˆëŸ¬ì˜¤ê¸° (í˜„ì¬ëŠ” ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©)
    elBtnLoad.addEventListener("click", async () => {
      // ë§Œì•½ Apps Script ì—°ë™ ì‹œ:
      // const res = await fetch(SHEET_URL);
      // const json = await res.json();
      // state.members = json.members;
      // state.relations = json.relations;

      state.members = sampleData.members;
      state.relations = sampleData.relations;
      updateStats();
      renderList();
      alert("ê´€ê³„ë„ ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒë‹¨ ëª¨ë“œì—ì„œ 'ë¦¬ìŠ¤íŠ¸'ë¥¼ ëˆŒëŸ¬ ë³´ì„¸ìš”.");
    });

    elBtnReset.addEventListener("click", () => {
      elQ.value = "";
      elFilterMbti.value = "";
      state.members = [];
      state.relations = [];
      elRelationList.innerHTML = '<div class="muted">ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
      updateStats();
    });

    elQ.addEventListener("input", () => {
      if(state.members.length === 0) return;
      renderList();
    });
    elFilterMbti.addEventListener("change", () => {
      if(state.members.length === 0) return;
      renderList();
    });

    function updateStats(){
      const total = state.members.length;
      let ok = 0, warnOrBad = 0;
      state.relations.forEach(r => {
        if(r.level === "ok") ok++;
        else warnOrBad++;
      });
      elStatTotal.textContent = total;
      elStatOk.textContent = ok;
      elStatWarn.textContent = warnOrBad;
    }

    function renderList(){
      const q = elQ.value.trim().toLowerCase();
      const mbtiFilter = elFilterMbti.value;

      if(state.members.length === 0){
        elRelationList.innerHTML = '<div class="muted">ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      const filtered = state.members.filter(m => {
        const matchText =
          m.name.toLowerCase().includes(q) ||
          m.mbti.toLowerCase().includes(q);
        const matchMbti = mbtiFilter ? m.mbti === mbtiFilter : true;
        return matchText && matchMbti;
      });

      if(filtered.length === 0){
        elRelationList.innerHTML =
          '<div class="muted">ê²€ìƒ‰/í•„í„°ì— í•´ë‹¹í•˜ëŠ” ì¸ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      const items = filtered.map(m => {
        const rels = state.relations.filter(
          r => r.from === m.id || r.to === m.id
        );
        let ok = 0, warn = 0, bad = 0;
        rels.forEach(r => {
          if(r.level === "ok") ok++;
          else if(r.level === "warn") warn++;
          else if(r.level === "bad") bad++;
        });

        return `
          <div class="rel-item">
            <div class="rel-top">
              <div class="rel-name">${m.name}</div>
              <div class="rel-mbti">${m.mbti}</div>
            </div>
            <div class="rel-summary">
              <span class="badge ok">ğŸ‘ ì˜ ë§ëŠ” ê´€ê³„ ${ok}ëª…</span>
              <span class="badge warn">âš ï¸ ì£¼ì˜ ê´€ê³„ ${warn}ëª…</span>
              <span class="badge bad">ğŸ’¥ ì¶©ëŒ ê´€ê³„ ${bad}ëª…</span>
            </div>
          </div>
        `;
      }).join("");

      elRelationList.innerHTML = items;
    }

    // ì´ˆê¸° ëª¨ë“œ: ê·¸ë˜í”„ ëª¨ë“œ + ìº”ë²„ìŠ¤ ë¹„ì›Œë‘ê¸°
    setMode("graph");
    elStage.innerHTML = '<div class="muted" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:13px;">ê´€ê³„ë„ ì˜ì—­ (ê·¸ë˜í”„ ë Œë”ë§ ë¡œì§ ì—°ê²° ì˜ˆì •)</div>';
  </script>
</body>
</html>
